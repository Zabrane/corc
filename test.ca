{% #include "test.h" %}

async read_socket(struct test_s* data) {
  while {% !data->closed %} {
    await;
    read_socket;
  }
  call bar;
  {% data.test = 0; %}
  test;
  await;
  if {% data.test == 1 %} {
    thing1;
    await;
  } else {
    thing2;
    await;
  }
}

sub bar {
  while bax {
    await;
    bim;
  }
}

{%

void foo() {
}

%}
